// generate-sitemap.js
// Auto-generate sitemap.xml from finalProductDatabase
// Run with: node generate-sitemap.js

const fs = require('fs');

// Load products (CommonJS or adapted export)
const { finalProductDatabase } = require('./js/products.js');

const DOMAIN = 'https://v5md.com';
const NOW = new Date().toISOString();

function url(loc, priority = '0.7', changefreq = 'monthly') {
  return `  <url>\n    <loc>${loc}</loc>\n    <lastmod>${NOW}</lastmod>\n    <changefreq>${changefreq}</changefreq>\n    <priority>${priority}</priority>\n  </url>`;
}

let urls = [];

// Core pages
urls.push(url(`${DOMAIN}/`, '1.0', 'weekly'));
urls.push(url(`${DOMAIN}/catalog.html`, '0.9', 'weekly'));
urls.push(url(`${DOMAIN}/about.html`, '0.8'));
urls.push(url(`${DOMAIN}/contact.html`, '0.8'));
urls.push(url(`${DOMAIN}/blog.html`, '0.8', 'weekly'));
urls.push(url(`${DOMAIN}/faq.html`, '0.6', 'quarterly'));
urls.push(url(`${DOMAIN}/privacy.html`, '0.5', 'yearly'));
urls.push(url(`${DOMAIN}/terms.html`, '0.5', 'yearly'));

// Category pages (deduplicated)
const categories = [...new Set(Object.values(finalProductDatabase).map(p => p.category))];
categories.forEach(cat => {
  urls.push(
    url(`${DOMAIN}/catalog.html?category=${encodeURIComponent(cat)}`, '0.8', 'monthly')
  );
});

// Product detail pages
Object.values(finalProductDatabase).forEach(p => {
  urls.push(
    url(`${DOMAIN}/product-detail.html?product=${p.id}`, '0.7', 'monthly')
  );
});

const sitemap = `<?xml version="1.0" encoding="UTF-8"?>\n<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">\n${urls.join('\n')}\n</urlset>`;

fs.writeFileSync('sitemap.xml', sitemap);
console.log('sitemap.xml generated successfully');
